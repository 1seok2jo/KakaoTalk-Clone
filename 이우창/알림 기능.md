

# ì•Œë¦¼ ê¸°ëŠ¥

## âœ… 1. ê¸°ëŠ¥ ì´ë¦„

ì›¹ í‘¸ì‹œ ì•Œë¦¼ êµ¬ë… ë“±ë¡

## âœ… 2. ê¸°ëŠ¥ ì„¤ëª… (í•œ ì¤„ ìš”ì•½)

í´ë¼ì´ì–¸íŠ¸ì˜ ë¸Œë¼ìš°ì €ì—ì„œ í‘¸ì‹œ ì•Œë¦¼ì„ ìˆ˜ì‹ í•  ìˆ˜ ìžˆë„ë¡ êµ¬ë… ì •ë³´ë¥¼ ì„œë²„ì— ë“±ë¡í•œë‹¤.

## âœ… 3. ì£¼ìš” íë¦„ / ì‹œë‚˜ë¦¬ì˜¤

1. ì‚¬ìš©ìžê°€ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì•Œë¦¼ ìˆ˜ì‹ ì„ í—ˆìš©í•˜ê³ , êµ¬ë… ì •ë³´ë¥¼ ìƒì„±í•œë‹¤.

2. í´ë¼ì´ì–¸íŠ¸ê°€ /api/push/subscribeë¡œ êµ¬ë… ì •ë³´ë¥¼ ì „ì†¡í•œë‹¤.

3. ì„œë²„ëŠ” ì‚¬ìš©ìžì˜ IDë¥¼ ê¸°ì¤€ìœ¼ë¡œ êµ¬ë… ì •ë³´ë¥¼ ì €ìž¥í•œë‹¤.

4. í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ë“±ë¡ ì„±ê³µ ë©”ì‹œì§€ë¥¼ ë°˜í™˜í•œë‹¤.

## âœ… 4. ìš”ì²­ DTO ì˜ˆì‹œ

```json
{

Â  "userId": 1234,

Â  "subscription": {

Â Â Â  "endpoint": "...",

Â Â Â  "keys": {

Â Â Â Â Â  "p256dh": "...",

Â Â Â Â Â  "auth": "..."

Â Â Â  }

Â  }

}  
```

## âœ… 5. ì‘ë‹µ í˜•ì‹ ì˜ˆì‹œ

```json
{

Â  "status": 200,

Â  "message": "êµ¬ë… ë“±ë¡ ì„±ê³µ",

Â  "data": {}

}  
```

## âœ… 6. ì˜ˆì™¸ ì¼€ì´ìŠ¤ / ì‹¤íŒ¨ ìƒí™©

- í•„ë“œ ëˆ„ë½ â†’ 400 ì—ëŸ¬- ì¸ì¦ ì‹¤íŒ¨ â†’ 401 ì—ëŸ¬  
- ë¹„ì •ìƒì ì¸ í‚¤ êµ¬ì¡° â†’ 400 ì—ëŸ¬

## âœ… 7. ì—”ë“œí¬ì¸íŠ¸ ì •ë³´

- URL: /api/push/subscribe- Method: POST- ì¸ì¦ í•„ìš” ì—¬ë¶€: ë¡œê·¸ì¸ í•„ìš”

## âœ… 8. ë‹´ë‹¹ìž

ì´ìš°ì°½

## ðŸ“Œ ì˜ˆì‹œ ì½”ë“œ (Controller ì˜ˆì‹œ)

ì¢€ ë” ê³µë¶€í•´ë³´ê³  ìž‘ì„±í•˜ê² ìŠµë‹ˆë‹¤.  

## ðŸ“Œ ì˜ˆì‹œ ì½”ë“œ (DTO ì˜ˆì‹œ)

ì¢€ ë” ê³µë¶€í•´ë³´ê³  ìž‘ì„±í•˜ê² ìŠµë‹ˆë‹¤.  





## âœ… 1. ê¸°ëŠ¥ ì´ë¦„

ì›¹ í‘¸ì‹œ ì•Œë¦¼ ì „ì†¡

## âœ… 2. ê¸°ëŠ¥ ì„¤ëª… (í•œ ì¤„ ìš”ì•½)

ì €ìž¥ëœ êµ¬ë… ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì‚¬ìš©ìžì—ê²Œ ë¸Œë¼ìš°ì € í‘¸ì‹œ ì•Œë¦¼ì„ ì „ì†¡í•œë‹¤.

## âœ… 3. ì£¼ìš” íë¦„ / ì‹œë‚˜ë¦¬ì˜¤

1. ChatServiceì—ì„œ NotificationServiceë¡œ ì•Œë¦¼ ì „ì†¡ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•œë‹¤.
2. ì„œë²„ëŠ” DBì—ì„œ í•´ë‹¹ ì‚¬ìš©ìž IDì˜ êµ¬ë… ì •ë³´ë¥¼ ì¡°íšŒí•œë‹¤.  
3. webpush-javaì˜ PushServiceë¥¼ ì´ìš©í•´ í‘¸ì‹œ ì•Œë¦¼ì„ ì „ì†¡í•œë‹¤.
4. ì „ì†¡ ì„±ê³µ/ì‹¤íŒ¨ ì—¬ë¶€ëŠ” ë‚´ë¶€ ë¡œê¹… ë˜ëŠ” ì˜ˆì™¸ ì²˜ë¦¬ë¡œ ê´€ë¦¬í•œë‹¤.

## âœ… 4. ìš”ì²­ íŒŒë¼ë¯¸í„° ì˜ˆì‹œ

```java
public class PushMessage {

Â Â Â  private Long userId;

Â Â Â  private String title;

Â Â Â  private String body;

}  
```

## âœ… 5. ë°˜í™˜ ê°’ ì˜ˆì‹œ

```java
public class PushResult {

    private boolean success;

    private String errorMessage;

}
```

## âœ… 6. ì˜ˆì™¸ ì¼€ì´ìŠ¤ / ì‹¤íŒ¨ ìƒí™©

- ì‚¬ìš©ìž êµ¬ë… ì •ë³´ ì—†ìŒ â†’ UserSubscriptionNotFoundException
- í‘¸ì‹œ ì „ì†¡ ì‹¤íŒ¨ â†’ PushSendException

## âœ… 7. ì—”ë“œí¬ì¸íŠ¸ ì •ë³´

- ì—†ìŒ (ë‚´ë¶€ ì„œë¹„ìŠ¤ í˜¸ì¶œë¡œë§Œ ìž‘ë™)  

## âœ… 8. ë‹´ë‹¹ìž

ì´ìš°ì°½

## ðŸ“Œ ì˜ˆì‹œ ì½”ë“œ

### í˜¸ì¶œ ì˜ˆì‹œ

```java

// ChatService
public void sendMessage(ChatMessage message) {

    // 1. ë©”ì‹œì§€ ì €ìž¥

    chatRepository.save(message);

    // 2. ì•Œë¦¼ ì „ì†¡

    PushMessage pushMessage = new PushMessage(

        message.getReceiverId(),

        "ìƒˆ ë©”ì‹œì§€ ì•Œë¦¼",

        message.getContent()

    );

    pushNotificationService.send(pushMessage);

}
```

### Service ì˜ˆì‹œ

```java
// NotificationService
public void send(PushMessage pushMessage) {
    Subscription subscription = subscriptionRepository.findByUserId(pushMessage.getUserId())
        .orElseThrow(() -> new UserSubscriptionNotFoundException());

    Notification notification = new Notification(
        subscription.getEndpoint(),
        subscription.getKeys().getP256dh(),
        subscription.getKeys().getAuth(),
        createPayload(pushMessage)
    );

    pushService.send(notification);
}
```


